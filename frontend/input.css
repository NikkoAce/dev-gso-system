@import "tailwindcss/base";
@import "tailwindcss/components";
@import "tailwindcss/utilities";
@layer components {
    /* --- NEW: Add base transition to sidebar for smooth expand/collapse --- */
    #sidebar-container {
        @apply transition-all duration-300 ease-in-out;
    }
    /* --- NEW: Add gap between icon and text in menu items --- */
    .menu :where(li > a), .menu :where(li > details > summary) {
        @apply gap-4;
    }

    /* Styles for when the sidebar is collapsed on desktop */
    .sidebar-collapsed #sidebar-container {
        @apply w-20;
    }

    /* NEW: Hide expanded logo/text, show collapsed logo */
    .sidebar-collapsed .sidebar-expanded-logo {
        @apply hidden;
    }
    .sidebar-collapsed .sidebar-collapsed-logo {
        @apply block;
    }

    /* --- NEW: Add base styles for smooth text transitions --- */
    .nav-text, #user-name, #user-office, #logout-button, #sidebar-container .form-control {
        @apply transition-all duration-200 ease-in-out whitespace-nowrap overflow-hidden;
    }

    /* --- MODIFIED: Hide text elements by animating them away --- */
    .sidebar-collapsed .nav-text,
    .sidebar-collapsed #user-name,
    .sidebar-collapsed #user-office,
    .sidebar-collapsed #logout-button,
    .sidebar-collapsed #sidebar-container .form-control {
        @apply opacity-0 w-0 pointer-events-none;
    }

    /* Center the icons and user avatar */
    .sidebar-collapsed #sidebar-container .menu li > a,
    .sidebar-collapsed #sidebar-container .menu li > details > summary {
        @apply justify-center;
    }
    
    .sidebar-collapsed #sidebar-container #sidebar-user-info {
        @apply justify-center; /* Use the ID to prevent circular dependency */
    }

    /* Hide the dropdown arrow for details/summary */
    .sidebar-collapsed #sidebar-container .menu details > summary::after {
        @apply hidden;
    }

    /* Reduce padding on the main menu UL to prevent overflow */
    .sidebar-collapsed #sidebar-nav > .menu {
        @apply py-2 px-0;
    }

    /* NEW: Allow fly-out menus to overflow the nav container when collapsed */
    .sidebar-collapsed #sidebar-nav {
        @apply overflow-visible;
    }

    /* --- NEW: Fly-out Submenu Logic for Collapsed Sidebar --- */
    .sidebar-collapsed #sidebar-container .menu li {
        @apply relative;
    }

    /* When collapsed, reduce horizontal padding on menu items to prevent overflow */
    .sidebar-collapsed .menu-lg :where(li > a),
    .sidebar-collapsed .menu-lg :where(li > details > summary) {
        @apply px-4;
    }

    /* When collapsed, style the submenu as a fly-out panel. It's shown when its parent <details> has the `open` attribute (handled by JS). */
    .sidebar-collapsed #sidebar-container .menu details > ul {
        @apply absolute left-16 top-0 z-20 w-auto rounded-box bg-base-200 p-1 shadow-lg;
        /* Add transition for fade effect and remove the gap */
        @apply opacity-0 invisible transition-all duration-200;
    }

    /* Make the fly-out visible when the details element is open */
    .sidebar-collapsed #sidebar-container .menu details[open] > ul {
        @apply opacity-100 visible;
    }

    /* --- NEW: Fix fly-out menu item display --- */
    /* The 'li' has a .tooltip class which makes it inline-block. Override this for the fly-out. */
    .sidebar-collapsed #sidebar-container .menu details > ul li {
        @apply block;
    }
    /* The .nav-text is hidden globally when collapsed. Un-hide it for the fly-out menu. */
    /* Text in fly-out is now hidden by the global .sidebar-collapsed .nav-text rule. */

    /* --- NEW: Style links inside the fly-out menu to give them padding and a hover effect --- */
    .sidebar-collapsed #sidebar-container .menu details > ul a {
        @apply w-full p-3 rounded-md flex justify-center items-center; /* Center the icon */
    }

    /* Icon alignment is handled by the parent 'a' tag now. */
    .sidebar-collapsed #sidebar-container .menu details > ul a:hover {
        @apply bg-base-300;
    }

    /* --- NEW: Fix sub-menu alignment in UNCOLLAPSED sidebar --- */
    /* The .tooltip class on sub-menu LIs can make them inline-block. Force them to be block elements to stack vertically. */
    body:not(.sidebar-collapsed) #sidebar-container .menu details > ul li {
        @apply block;
    }
    /* Also ensure the link content (icon + text) is aligned horizontally. */
    body:not(.sidebar-collapsed) #sidebar-container .menu details > ul a {
        @apply flex items-center;
    }

    /* --- NEW: Animate the toggle button icon rotation --- */
    #sidebar-toggle-btn > svg {
        @apply transition-transform duration-300;
    }

    .sidebar-collapsed #sidebar-toggle-btn > svg {
        @apply rotate-180;
    }

    /* --- NEW: Tooltip visibility logic --- */
    /* By default (expanded sidebar), hide the tooltips completely to prevent them from showing on hover. */
    body:not(.sidebar-collapsed) #sidebar-container .tooltip:before,
    body:not(.sidebar-collapsed) #sidebar-container .tooltip:after {
        @apply hidden;
    }
}
