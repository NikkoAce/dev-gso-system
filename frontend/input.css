@import "tailwindcss/base";
@import "tailwindcss/components";
@import "tailwindcss/utilities";
@layer components {
    /* --- NEW: Add base transition to sidebar for smooth expand/collapse --- */
    #sidebar-container {
        @apply transition-all duration-300 ease-in-out;
    }
    /* --- NEW: Add gap between icon and text in menu items --- */
    .menu :where(li > a), .menu :where(li > details > summary) {
        @apply gap-4;
    }

    /* Styles for when the sidebar is collapsed on desktop */
    .sidebar-collapsed #sidebar-container {
        @apply w-20;
    }

    /* NEW: Hide expanded logo/text, show collapsed logo */
    .sidebar-collapsed .sidebar-expanded-logo {
        @apply hidden;
    }
    .sidebar-collapsed .sidebar-collapsed-logo {
        @apply block;
    }

    /* --- NEW: Add base styles for smooth text transitions --- */
    .nav-text, #user-name, #user-office, #logout-button, #sidebar-container .form-control {
        @apply transition-all duration-200 ease-in-out overflow-hidden;
    }

    /* --- MODIFIED: Hide text elements by animating them away --- */
    .sidebar-collapsed .nav-text,
    .sidebar-collapsed #user-name,
    .sidebar-collapsed #user-office,
    .sidebar-collapsed #logout-button,
    .sidebar-collapsed #sidebar-container .form-control {
        /* Add whitespace-nowrap here to keep the collapse animation smooth */
        @apply opacity-0 w-0 pointer-events-none whitespace-nowrap;
    }

    /* Center the icons and user avatar */
    .sidebar-collapsed #sidebar-container .menu li > a,
    .sidebar-collapsed #sidebar-container .menu li > details > summary {
        @apply justify-center;
    }
    
    .sidebar-collapsed #sidebar-container #sidebar-user-info {
        @apply justify-center; /* Use the ID to prevent circular dependency */
    }

    /* Hide the dropdown arrow for details/summary */
    .sidebar-collapsed #sidebar-container .menu details > summary::after {
        @apply hidden;
    }

    /* Reduce padding on the main menu UL to prevent overflow */
    .sidebar-collapsed #sidebar-nav > .menu {
        @apply py-2 px-0;
    }

    /* NEW: Allow fly-out menus to overflow the nav container when collapsed */
    .sidebar-collapsed #sidebar-nav {
        @apply overflow-visible;
    }

    /* --- NEW: Fly-out Submenu Logic for Collapsed Sidebar --- */
    .sidebar-collapsed #sidebar-container .menu li {
        @apply relative;
    }

    /* When collapsed, reduce horizontal padding on menu items to prevent overflow */
    .sidebar-collapsed .menu-lg :where(li > a),
    .sidebar-collapsed .menu-lg :where(li > details > summary) {
        @apply px-4;
    }

    /* When collapsed, style the submenu as a fly-out panel. It's shown when its parent <details> has the `open` attribute (handled by JS). */
    .sidebar-collapsed #sidebar-container .menu details > ul {
        @apply absolute left-16 top-0 z-20 w-auto rounded-box bg-base-200 p-1 shadow-lg;
        /* Add transition for fade effect and remove the gap */
        @apply opacity-0 invisible transition-all duration-200;
    }

    /* Make the fly-out visible when the details element is open */
    .sidebar-collapsed #sidebar-container .menu details[open] > ul {
        @apply opacity-100 visible;
    }

    /* --- NEW: Fix fly-out menu item display --- */
    /* The 'li' has a .tooltip class which makes it inline-block. Override this for the fly-out. */
    .sidebar-collapsed #sidebar-container .menu details > ul li {
        @apply block;
    }
    /* The .nav-text is hidden globally when collapsed. Un-hide it for the fly-out menu. */
    /* Text in fly-out is now hidden by the global .sidebar-collapsed .nav-text rule. */

    /* --- NEW: Style links inside the fly-out menu to give them padding and a hover effect --- */
    .sidebar-collapsed #sidebar-container .menu details > ul a {
        @apply w-full p-3 rounded-md flex justify-center items-center; /* Center the icon */
    }

    /* Icon alignment is handled by the parent 'a' tag now. */
    .sidebar-collapsed #sidebar-container .menu details > ul a:hover {
        @apply bg-base-300;
    }

    /* --- NEW: Fix sub-menu alignment in UNCOLLAPSED sidebar --- */
    /* The .tooltip class on sub-menu LIs can make them inline-block. Force them to be block elements to stack vertically. */
    body:not(.sidebar-collapsed) #sidebar-container .menu details > ul li {
        @apply block;
    }
    /* Also ensure the link content (icon + text) is aligned horizontally. */
    body:not(.sidebar-collapsed) #sidebar-container .menu details > ul a {
        @apply flex items-center;
    }

    /* --- NEW: Animate the toggle button icon rotation --- */
    #sidebar-toggle-btn > svg {
        @apply transition-transform duration-300;
    }

    .sidebar-collapsed #sidebar-toggle-btn > svg {
        @apply rotate-180;
    }

    /* --- NEW: Tooltip visibility logic --- */
    /* By default (expanded sidebar), hide the tooltips completely to prevent them from showing on hover. */
    body:not(.sidebar-collapsed) #sidebar-container .tooltip:before,
    body:not(.sidebar-collapsed) #sidebar-container .tooltip:after {
        @apply hidden;
    }

    /* --- NEW: Responsive Table for Mobile --- */
    @media screen and (max-width: 767px) {
        .responsive-table {
            @apply block;
        }
        .responsive-table thead {
            @apply hidden;
        }
        .responsive-table tbody, .responsive-table tr {
            @apply block w-full;
        }
        .responsive-table tr {
            @apply mb-4 border border-base-300 rounded-lg block;
        }
        .responsive-table td {
            @apply block p-4 border-b border-base-300/50;
        }
        .responsive-table td:last-child {
            @apply border-b-0;
        }
        .responsive-table td::before {
            content: attr(data-label);
            @apply block font-semibold text-left mb-2 text-sm text-base-content/80;
        }
    }
    /* --- NEW: Custom Card Layout for Asset Registry on Mobile --- */
    @media screen and (max-width: 767px) {
        .asset-registry-mobile-layout {
            @apply block;
        }
        .asset-registry-mobile-layout thead {
            @apply hidden;
        }
        .asset-registry-mobile-layout tbody,
        .asset-registry-mobile-layout tr {
            @apply block w-full;
        }
        /* The TR becomes the card */
        .asset-registry-mobile-layout tr {
            @apply mb-4 border border-base-300 rounded-lg block overflow-visible;
            display: flex;
            flex-wrap: wrap;
        }
        /* Override zebra-striping for mobile card view */
        .asset-registry-mobile-layout tr:nth-child(2n) {
            --tw-bg-opacity: 1;
            background-color: oklch(var(--b1) / var(--tw-bg-opacity));
        }
        .asset-registry-mobile-layout td {
            @apply block border-0 p-3;
        }
        .asset-registry-mobile-layout td::before {
            @apply hidden; /* Hide all labels by default */
        }

        /* --- Card Structure --- */
        /* Header: Select Checkbox */
        .asset-registry-mobile-layout td[data-label="Select"] {
            order: 1;
            @apply w-full flex items-center justify-between bg-base-200 border-b border-base-300/50;
        }
        .asset-registry-mobile-layout td[data-label="Select"]::before {
            content: "Select Asset";
            @apply block font-semibold text-sm;
        }

        /* --- Card Body --- */
        /* Row 1: Property No & Status */
        .asset-registry-mobile-layout td[data-label="Property No."] { order: 2; @apply w-2/3 font-bold text-left; }
        .asset-registry-mobile-layout td[data-label="Status"] { order: 3; @apply w-1/3 flex justify-end items-center; }

        /* Row 2: Description */
        .asset-registry-mobile-layout td[data-label="Description"] { order: 4; @apply w-full pt-0 border-t border-base-300/50 text-left; }

        /* Row 3: Category & Custodian */
        .asset-registry-mobile-layout td[data-label="Category"] { order: 5; @apply w-1/2 text-sm text-base-content/70 border-t border-base-300/50 text-left; }
        .asset-registry-mobile-layout td[data-label="Custodian"] { order: 6; @apply w-1/2 text-sm text-base-content/70 border-t border-base-300/50 text-left; }

        /* Row 4: Dates with labels */
        .asset-registry-mobile-layout td[data-label="Date Acquired"] { order: 7; @apply w-1/2 text-xs border-t border-base-300/50 text-left; }
        .asset-registry-mobile-layout td[data-label="Date Created"] { order: 8; @apply w-1/2 text-xs border-t border-base-300/50 text-left; }
        .asset-registry-mobile-layout td[data-label="Date Acquired"]::before,
        .asset-registry-mobile-layout td[data-label="Date Created"]::before { content: attr(data-label); @apply block font-semibold text-base-content/70; }

        /* Card Footer */
        .asset-registry-mobile-layout td[data-label="Actions"] {
            order: 9;
            @apply w-full flex justify-between items-center bg-base-200 border-t border-base-300/50;
        }
        .asset-registry-mobile-layout td[data-label="Actions"]::before {
            content: attr(data-label);
            @apply block font-semibold text-sm;
        }
    }

    /* --- NEW: Custom Card Layout for Physical Count on Mobile --- */
    @media screen and (max-width: 767px) {
        .physical-count-mobile-layout {
            @apply block;
        }
        .physical-count-mobile-layout thead {
            @apply hidden;
        }
        .physical-count-mobile-layout tbody,
        .physical-count-mobile-layout tr {
            @apply block w-full;
        }
        /* The TR becomes the card */
        .physical-count-mobile-layout tr {
            @apply mb-4 border border-base-300 rounded-lg block overflow-visible;
        }
        /* Override zebra-striping for mobile card view */
        .physical-count-mobile-layout tr:nth-child(2n) {
            --tw-bg-opacity: 1;
            background-color: oklch(var(--b1) / var(--tw-bg-opacity));
        }
        .physical-count-mobile-layout td {
            @apply block p-3 border-b border-base-300/50;
        }
        .physical-count-mobile-layout td:last-child {
            @apply border-b-0;
        }

        /* Card Header */
        .physical-count-mobile-layout td[data-label="Property No."] { @apply font-bold; }
        .physical-count-mobile-layout td[data-label="Description"] { @apply pt-0 text-sm; }
        .physical-count-mobile-layout td[data-label="Custodian"] { @apply pt-0 text-xs text-base-content/70; }

        /* Card Body (Form Inputs) */
        .physical-count-mobile-layout td[data-label="Status / Condition"],
        .physical-count-mobile-layout td[data-label="Remarks"] {
            @apply flex flex-col items-start;
        }
        /* Re-create the label using the data-label attribute */
        .physical-count-mobile-layout td[data-label="Status / Condition"]::before,
        .physical-count-mobile-layout td[data-label="Remarks"]::before {
            content: attr(data-label);
            @apply block font-semibold text-sm mb-1;
        }

        /* Card Footer (Verification) */
        .physical-count-mobile-layout td[data-label="Verified"] {
            @apply flex items-center justify-between bg-base-200;
        }
        .physical-count-mobile-layout td[data-label="Verified"]::before {
            content: attr(data-label);
            @apply font-semibold text-sm;
        }
    }

    /* --- NEW: Flash effect for real-time updates --- */
    .flash-success {
        transition: background-color 0.5s ease-out;
        /* DaisyUI success color with 20% opacity */
        background-color: oklch(var(--su) / 0.2) !important;
    }
    .flash-update {
        transition: background-color 0.5s ease-out;
        /* DaisyUI warning color with 20% opacity */
        background-color: oklch(var(--wa) / 0.2) !important;
    }

    /* --- NEW: Indicator for unsaved changes on a table row --- */
    .row-dirty > td:first-child {
        position: relative;
    }
    .row-dirty > td:first-child::before {
        content: '';
        position: absolute;
        left: 6px; /* Position the dot inside the cell padding */
        top: 50%;
        transform: translateY(-50%);
        width: 8px;
        height: 8px;
        border-radius: 9999px;
        background-color: oklch(var(--wa)); /* DaisyUI 'warning' color */
    }
}

    /* --- NEW: Flash effect for real-time updates --- */
    .flash-success {
        transition: background-color 0.5s ease-out;
        /* DaisyUI success color with 20% opacity */
        background-color: oklch(var(--su) / 0.2) !important;
    }
    .flash-update {
        transition: background-color 0.5s ease-out;
        /* DaisyUI warning color with 20% opacity */
        background-color: oklch(var(--wa) / 0.2) !important;
    }
}
